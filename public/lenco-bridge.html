<!DOCTYPE html>
<html lang=\"en\">
  <head>
    <meta charset=\"utf-8\" />
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />
    <title>Lenco Checkout</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #0f172a;
        color: #fff;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #status {
        text-align: center;
        padding: 2rem;
        line-height: 1.5;
      }
      iframe {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        border: 0;
        background: #000;
      }
      button {
        margin-top: 1rem;
        background: rgba(255,255,255,0.15);
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 9999px;
        padding: 0.4rem 1.2rem;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id=\"status\">
      Opening secure Lenco checkout...
      <br />
      If the window stays blank, please allow pop-ups for Vibely and try again.
      <br />
      <button type=\"button\" id=\"closeBtn\">Cancel</button>
    </div>
    <script>
      (function () {
        const PAY_ORIGIN = 'https://pay.lenco.co';
        const closeBtn = document.getElementById('closeBtn');
        const statusEl = document.getElementById('status');
        let iframe = null;
        let currentOrigin = window.location.origin;
        let parentOrigin = '*';
        const relayToParent = (payload) => {
          if (window.opener && !window.opener.closed) {
            window.opener.postMessage({ source: 'lenco-bridge', payload }, parentOrigin);
          }
        };
        const setStatus = (text) => {
          if (statusEl) {
            statusEl.innerHTML = text;
          }
        };
        const ensureIframe = (originHint) => {
          if (iframe) {
            return iframe;
          }
          const origin = originHint || currentOrigin;
          iframe = document.createElement('iframe');
          iframe.src = PAY_ORIGIN + '/popup?origin=' + encodeURIComponent(origin);
          iframe.allow = [
            'payment *',
            'fullscreen *',
            'geolocation *',
            'microphone *',
            'camera *',
            'clipboard-write',
            'clipboard-read',
            'storage-access-by-user-activation'
          ].join('; ');
          iframe.referrerPolicy = 'no-referrer';
          iframe.loading = 'eager';
          document.body.appendChild(iframe);
          if (statusEl) {
            statusEl.remove();
          }
          return iframe;
        };
        const relayToIframe = (message) => {
          if (!iframe || !iframe.contentWindow) return;
          iframe.contentWindow.postMessage(message, PAY_ORIGIN);
        };
        window.addEventListener('message', (event) => {
          if (event.source === window.opener) {
            const data = event.data;
            if (!data || (data.type !== 'lenco:init' && data.type !== 'lenco:ping')) {
              return;
            }
            if (data.type === 'lenco:init') {
              parentOrigin = data.payload?.returnOrigin || '*';
              currentOrigin = data.payload?.origin || currentOrigin;
              ensureIframe(currentOrigin);
              relayToIframe({ type: 'initialize', data: data.payload?.session });
              relayToParent({ type: 'bridge:ready' });
            }
            return;
          }
          if (iframe && event.source === iframe.contentWindow) {
            relayToParent(event.data);
            if (event.data && (event.data.type === 'lenco:close' || event.data.type === 'callback:close')) {
              window.close();
            }
          }
        });
        window.addEventListener('beforeunload', () => {
          relayToParent({ type: 'bridge:closed' });
        });
        closeBtn?.addEventListener('click', () => {
          relayToParent({ type: 'bridge:closed' });
          window.close();
        });
        relayToParent({ type: 'bridge:booted' });
      })();
    </script>
  </body>
</html>
